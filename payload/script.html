<script>
    (function () {
        const k = "mdviewer_theme_mode";
        const r = document.documentElement;
        const b = document.getElementById("mvTheme");
        const m = window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)");
        function sysDark() {
            return !!(m && m.matches);
        }
        function effective(mode) {
            const d = sysDark();
            const useDark = (mode === "invert") ? !d : d;
            return useDark ? "dark" : "light";
        }
        function setLabel(mode, theme) {
            const t = (theme === "dark") ? "Dark" : "Light";
            b.textContent = (mode === "invert")
                ? ("Theme: Invert (" + t + ")")
                : ("Theme: System (" + t + ")");
        }
        function apply(mode) {
            const th = effective(mode);
            r.dataset.theme = th;
            setLabel(mode, th);
        }
        let mode = localStorage.getItem(k) || "system";
        if (mode !== "system" && mode !== "invert") mode = "system";
        apply(mode);
        b.addEventListener("click", function () {
            mode = (mode === "system") ? "invert" : "system";
            localStorage.setItem(k, mode);
            apply(mode);
        });
        if (m) {
            const onChange = function () {
                apply(mode);
            };
            if (m.addEventListener) {
                m.addEventListener("change", onChange);
            } else m.addListener(onChange);
        }
    })();
</script>
